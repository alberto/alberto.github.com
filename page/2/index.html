
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>sharp bites</title>
  <meta name="author" content="alberto">

  
  <meta name="description" content="@jjballano&nbsp;recently&nbsp;posted&nbsp;his version of the Greed game, as part of his learning experience with Ruby Koans. As I am following that &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.sharpbites.com/page/2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="sharp bites" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3088208-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">sharp bites</a></h1>
  
    <h2>standing on the shoulders of giants</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.sharpbites.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/12/20/greed-game-koan/">Greed game koan</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-20T00:00:00+01:00" pubdate data-updated="true">Dec 20<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<a href="http://twitter.com/jjballano">@jjballano</a>&nbsp;recently&nbsp;<a href="https://gist.github.com/736614">posted</a>&nbsp;his version of the <a href="http://en.wikipedia.org/wiki/Greed_(dice_game)">Greed game</a>, as part of his learning experience with <a href="http://rubykoans.com/">Ruby Koans</a>. As I am following that very same path, I thought it could also be worth for me to share <a href="https://gist.github.com/747881">my implementation of Greed</a> for people to comment on it.<br /><br /><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">The code could surely be much prettier since I am still trying to get my head around ruby block-passing, among others, so comments (and patches!) are welcome.</div><div><br /></div><br /><script src="https://gist.github.com/747881.js?file=score.rb"></script><br /><br />UPDATE: The code seems to update automatically to the latest version on github, you can find the original <a href="https://gist.github.com/747881/3b8cb77970b0b22b2265904b3c02acf7bae84a3f#file_score.rb">here</a>.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/11/30/writing-better-object-oriented-code/">Writing Better Object Oriented Code</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-30T00:00:00+01:00" pubdate data-updated="true">Nov 30<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<a href="http://twitter.com/#!/gregyoung">Greg Young</a> did a great presentation at <a href="http://www.oredev.org/">Oredev</a> about <a href="http://vimeo.com/17151526">writing Object Oriented code the right way</a>. It&#8217;s so full of good stuff I could not bother to make a summary out of it. Go watch the original video. Now.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/11/26/ive-read-peopleware/">I&#8217;ve read: Peopleware</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-26T00:00:00+01:00" pubdate data-updated="true">Nov 26<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
&#8216;Peopleware&#8217; is one of those classic books of our profession, a must-read. Unfortunately, it&#8217;s not easy to grab a copy of it on the stores (it may have been discontinued, I&#8217;m not sure).&nbsp;After a failed attempt to borrow it from <a href="http://twitter.com/jmbeas">Jose Manuel Beas</a>,&nbsp;a few weeks ago, I finally got the chance to read it (thanks <a href="http://twitter.com/rubenbpv">Rub√©n</a>!).<br /><br />All I can say is, if you have the chance, read it! Just so you can have a glimpse at it, here are some notes I&nbsp;took from it. Most are direct quotes,&nbsp;although&nbsp;I reworded a few to&nbsp;synthesize.<br /><br /><span class="Apple-style-span" style="font-size: large;">Productivity</span><br /><span class="Apple-style-span" style="font-size: large;"><span class="Apple-style-span" style="font-size: small;">As long as workers are crowded into noisy, disruptive space, it&#8217;s not worth improving anything but the workspace.</span></span><br />Experiments showed projects without deadlines had the best productivity.<br />Better performance can be explained entirely by more effective ways of handling people, modifying the workplace and corporate culture.<br />Developers main work is human communication to organize the user&#8217;s expressions of needs into formal procedure.<br />People won&#8217;t work better under a lot of pressure.<br />The manager&#8217;s function is not to make people work, but to make it possible for people to work.<br />Best people outperform the worst by 10 and the median performer by 2.5.<br />Years of experience are not correlated to productivity.<br />Interrupting flow not only causes disruption but frustration.<br />There are two types of work: Individual work is noise sensitive and needs flow.&nbsp;Group work is noise producing. Adapt your workspace to make both kinds of work possible.<br />Measure and try to maximize flow time, but don&#8217;t let managers access to data.<br />Ignoring the phone must be accepted by corporate policy.<br />Ask people about their workspace conditions, what affects their productivity.<br />Listening to music uses the right part of the braing, which is responsible for creativity.<br />Encourage teams to customize their space.<br /><br /><span class="Apple-style-span" style="font-size: large;">People</span><br />People who work for you will be more or less the same at the end as they were at the beginning, so they better be right for the job from the start.<br />Find the right people, make them happy, turn them loose.<br />Success or failure is in the cards from the moment the team is formed and the initial directions set out.<br />Corporate pressure is pushing towards the company average, encouraging you to hire people that look, sound and think like everybody else.<br /><br /><span class="Apple-style-span" style="font-size: large;">Hiring</span><br />(Tell about hiring a juggler) &#8216;Don&#8217;t you want to see me juggle?&#8217;<br />Make people bring their code portfolio for interviews.<br />Make candidates prepare an audition with the team 10-to-15 minute presentation on some aspect of past work.<br /><br /><span class="Apple-style-span" style="font-size: large;">Good organizations</span><br />Late promotion is a sign of health.<br />With a low and flat hierarchy, people at the lowest level have, on average more years of experience.<br />Strive to be the best<br />Grow a community feeling.<br />Focus on long term benefits.<br />Widespread sense that you are expected to stay<br />Invest in personal growth<br />Retrain your people<br />When you automate a system, you make it deterministic, so it looses its self-healing ability. A&nbsp;<b>M</b>ethodology (capital &#8216;M&#8217; here) can produce the same results on you organization.<br />To achieve convergence of methods, use training, tools and peer review.<br />Don&#8217;t declare something a standard until it is a de facto standard.<br />Hawtorne effect (experiment of raising and lowering the light) People perform better when they are trying something new.<br />You have to make non-standard approaches to the rule. Whatever standard there is should be brief and gentle.<br />Let a hundred flowers blossom and let a hundred schools of thought contend. (Mao Tse-tung)<br /><br /><span class="Apple-style-span" style="font-size: large;">Jelled teams</span><br />Productive teams = challenge + team interaction<br />They have momentum.<br />They have a goal<br />The purpose of a team is not goal attainment but goal achievement.<br />People on jelled teams are often so involved you have to remind them&nbsp;that what they are trying to accomplish is not winning a war.<br />Jelled teams have low turnover and strong sense of identity.<br />Money, status and position for advance matter a lot less. Enjoyment is an obvious sign.<br />You can&#8217;t make teams jell, just act to improve the odds.<br />Teamicide techniques:<br /><br /><ul><li>Defensive management</li><li>Bureaucracy</li><li>Physical&nbsp;separation</li><li>Fragmentation of people&#8217;s time</li><li>Quality reduction</li><li>Phony deadlines</li><li>Clique control</li></ul><br />Good managers provide opportunities for the team to succeed together. The best success is the one in which there is no evident management. The best boss is the one who can manage without the team knowing they&#8217;ve been managed.<br /><br />Growing jelled teams:<br /><br /><ul><li>Give people autonomy and responsibility</li><li>Let them work alone, without constant supervision</li><li>They break the rules when they believe in it</li><li>Let them choose mates and projects</li><li>Let them exercise their natural authority in their area of expertise.</li></ul><br />Chemistry for team formation:<br /><br /><ul><li>Make a cult of quality</li><li>Provide satisfying confirmation</li><li>Build a sense of eliteness</li><li>Allow and encourage heterogeneity</li><li>Preserve and protect successful teams.</li><li>Provide strategic but not tactical direction</li></ul><br /><br /><span class="Apple-style-span" style="font-size: large;">Chaos (it is not that bad!)</span><br />Small amounts of disorder are benefitial<br />Pilot projects, war games, brainstorming, provocative training experiences, training, trips, conferences, celebrations, retreats,&#8230;<br /><br />If your corporation is fortunate enough to have a self-motivated superachiever on-board, it&#8217;s enough to say &#8220;Define your own job&#8221;<br />&#8220;Free electrons&#8221; have a strong role in choosing their own orbits.<br /><br /><span class="Apple-style-span" style="font-size: large;">Being a Change Agent</span><br />Focus on one thing to change. Raise people&#8217;s consciousness of it, so they help you change it.<br />Be careful with motivational posters, they can have the opposite effect.<br />Fuck overtime.<br />Competition inhibits coaching.<br />Any action that rewards team members differently is likely to foster competition.<br />The success of the individual should be tied to the success of the whole.<br />People hate change. Any change.<br />Your enemies are blindly loyals and militantly opposed to change.<br />The fundamental response to change is not logical, but emotional.<br />Celebrate the old as a way to help make change happen.<br />Be aware that chaos is an integral part of change. Otherwise, you mistake it for the new status quo and will want to change back.<br />Change always involves chaos, it is necessary and can&#8217;t be shortcut. The more painful the chaos, the greater the perceived value of the new status quo.<br />Change won&#8217;t even get started unless people feel safe when they know they won&#8217;t be demeaned for proposing or trying a change.<br />Change only has a chance of&nbsp;succeeding&nbsp;if failure is also&nbsp;OK.<br /><br /><span class="Apple-style-span" style="font-size: large;">Organizational learning</span><br />Learning is limited by an organization&#8217;s ability to keep its people.<br />If the retrained people leave, investment is lost and learning is gone.<br />Successful&nbsp;learning organizations are always characterized by strong middle management. In order for a vital learning center to form, middle managers must communicate with each other and learn to work together in effective harmony.<br /><br /><span class="Apple-style-span" style="font-size: large;">Waste</span><br />The ultimate management sin is wasting people&#8217;s time.<br />Organizations have need of ceremony.<br />Ceremony is good when it fulfills a need for appreciation by the team.<br />Early&nbsp;over-staffing&nbsp;is waste.<br />Fragmented time is waste, it breaks flow.<br /><br /><span class="Apple-style-span" style="font-size: large;">Community</span><br />Building a community makes a difference, but requires talent, courage and creativity. And an enormous invest of time, to be, at best, the catalyst.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/02/27/bash-completion-for-symfony/">Bash completion for symfony</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-02-27T00:00:00+01:00" pubdate data-updated="true">Feb 27<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<a href="http://www.tatai.es/">Fran</a>&nbsp;(a.k.a. tatai), one of my teammates at Biko, was kind enough to make us a nice (and unreadable) script to get <a href="http://github.com/biko2/symfony_complete">symfony bash completion</a>. Get it while it&#8217;s hot!<br /><br />You can read more about the script on <a href="http://www.tatai.es/2010/02/26/bash-completion-for-symfony/">tatai&#8217;s blog</a>.<br /><br />Kudos @tatai for your work!</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/11/08/sometimes-you-have-to-take-step-back/">Sometimes You Have To Take A Step Back Before You Can Move Forward</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-08T00:00:00+01:00" pubdate data-updated="true">Nov 8<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Or how I am moving to a PHP team to free myself from WebForms.<br /><br />So expect to find some stuff (probably including some rants) here about PHP from now on.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/10/19/altnerdinner-part-4-introducing/">AltNerDinner: Part 4. Introducing NHibernate. Because POCO is enough</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-19T00:00:00+02:00" pubdate data-updated="true">Oct 19<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<p>It&#8217;s time already to introduce a proper persistence solution. NHibernate can be a little intimidating at first for a new-comer, but I undoubtedly think it&#8217;s the way to go. And it&#8217;s not really more difficult than the other contenders anymore. Its two major drawbacks (hand writing all that XMhelL mapping and not strongly typed queries) are solved (or in serious process of it) by Fluent NHibernate and NHibernate.Linq.</p>  <p>Other than that, the only difficulty relies in learning a few concepts inherent to OR/Ms. Most notably the <a href="http://martinfowler.com/eaaCatalog/unitOfWork.html">Unit of Work</a> pattern and <a href="http://martinfowler.com/eaaCatalog/lazyLoad.html">Lazy Loading</a>, and all the stuff around them (namely repositories, query objects, persistence ignorance, POCOs, DTOs, entities/value objects and equality, inheritance mapping, dynamic proxies, caching, anemic domains, active record, transactions, concurrency, session lifetime, unit testing, select n+1 problems and other pitfalls to avoid,&#160; &#8230;). [NOTE: If you need more info on this topics I&#8217;d recommend you to visit the <a href="http://nhforge.org/">official nhibernate site</a>.]</p>  <p>Sounds scary? It might seem using an OR/M brings in more problems that the ones it solves, but I don&#8217;t think it is the case, except for maybe the most trivial apps (like AltNerdDinner, hehe, I know). Even if you are writing a relatively simple app, you can still greatly benefit from using NHibernate (or Active Record on top of it). If your app has inherent complexity, well, of course you&#8217;ll have to do your homework and learn a few concepts, but that&#8217;s not your OR/M&#8217;s fault. Using a hand-rolled DAL won&#8217;t make your problems go away (quite the opposite, I&#8217;d dare to say).</p>  <p>As I said, most (if not all) of this problems exist in all OR/M, it&#8217;s just that some of them somehow try to hide this complexity in one or another way. The problem is, this is a can of worms that can lead to very bad practices and slap on your face at any moment. And this is were I think this is were NHibernate excels at, its flexibility. It gets out of your way.</p>  <h4>Ok, enough talking! Show me the code!</h4>  <p>To use NHibernate and NH.Linq we need to add a reference in our project to the following dll&#8217;s: NHibernate, NHibernate.Linq, FluentNHibernate (if we hadn&#8217;t already) and lastly NHibernate.ByteCode.Castle if we want to use Castle&#8217;s dynamic proxy as our proxy generator of choice.</p>  <p>Here is the code for my DinnerRepository implementation using NHibernate:</p>  <pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">NhDinnerRepository </span>: <span style="color: #2b91af">IDinnerRepository<br /></span>{<br />    <span style="color: blue">private readonly </span><span style="color: #2b91af">ISession </span>_session;<br /><br />    <span style="color: blue">public </span>NhDinnerRepository(<span style="color: #2b91af">ISession </span>session)<br />    {<br />        _session = session;<br />    }<br /><br />    <span style="color: blue">private </span><span style="color: #2b91af">INHibernateQueryable</span>&lt;<span style="color: #2b91af">Dinner</span>&gt; GetDbContext()<br />    {<br />        <span style="color: blue">return </span>_session.Linq&lt;<span style="color: #2b91af">Dinner</span>&gt;();<br />    }<br /><br />    <span style="color: blue">public </span><span style="color: #2b91af">IQueryable</span>&lt;<span style="color: #2b91af">Dinner</span>&gt; FindAllDinners()<br />    {<br />        <span style="color: blue">return </span>GetDbContext().AsQueryable();<br />    }<br /><br />    <span style="color: blue">public </span><span style="color: #2b91af">IQueryable</span>&lt;<span style="color: #2b91af">Dinner</span>&gt; FindByLocation(<span style="color: blue">float </span>latitude, <span style="color: blue">float </span>longitude)<br />    {<br />        <span style="color: blue">return </span>GetDbContext().Where(d =&gt; d.Distance(latitude, longitude) &lt; 100).AsQueryable();<br />    }<br /><br />    <span style="color: blue">public </span><span style="color: #2b91af">IQueryable</span>&lt;<span style="color: #2b91af">Dinner</span>&gt; FindUpcomingDinners()<br />    {<br />        <span style="color: blue">return from </span>dinner <span style="color: blue">in </span>GetDbContext()<br />               <span style="color: blue">where </span>dinner.EventDate &gt; <span style="color: #2b91af">DateTime</span>.Now<br />               <span style="color: blue">orderby </span>dinner.EventDate<br />               <span style="color: blue">select </span>dinner;<br />    }<br /><br />    <span style="color: blue">public </span><span style="color: #2b91af">Dinner </span>GetDinner(<span style="color: blue">int </span>id)<br />    {<br />        <span style="color: blue">return </span>GetDbContext().SingleOrDefault(d =&gt; d.DinnerID == id);<br />    }<br /><br />    <span style="color: blue">public void </span>Save(<span style="color: #2b91af">Dinner </span>dinner)<br />    {<br />        <span style="color: blue">if </span>(!dinner.IsValid)<br />        {<br />            <span style="color: blue">throw new </span><span style="color: #2b91af">ApplicationException</span>(<span style="color: #a31515">&quot;Rule violations&quot;</span>);<br />        }<br /><br />        _session.SaveOrUpdate(dinner);<br />    }<br /><br />    <span style="color: blue">public void </span>Delete(<span style="color: #2b91af">Dinner </span>dinner)<br />    {<br />        _session.Delete(dinner);<br />    }</pre><br /><br /><p>As you see, I am returning IQueryable&lt;Dinner&gt; instead of traditional .NET collections. Some people think <a href="http://mikehadlow.blogspot.com/2009/01/should-my-repository-expose-iqueryable.html">IQueryable is the best thing since slice bread</a>, others are <a href="http://ayende.com/Blog/archive/2009/04/17/repository-is-the-new-singleton.aspx">ditching repositories entirely</a>, some prefer <a href="http://www.udidahan.com/2007/03/28/query-objects-vs-methods-on-a-repository/">using query objects</a>, others advocate for <a href="http://codebetter.com/blogs/gregyoung/archive/2009/01/16/ddd-the-generic-repository.aspx">explicit repositories</a>, some use <a href="http://serialseb.blogspot.com/2009/08/nhibernate-repository-that-oren-wont.html">generic ones</a> and I just don&#8217;t know yet, but decided to go at least with repositories because I want to take <a href="http://www.udidahan.com/2008/02/15/from-crud-to-domain-driven-fluency/">control of how entities are persisted</a>.</p><br /><br /><p>To instantiate my NHibernate repository, I need to supply it with an ISession. I <a href="http://ayende.com/Blog/archive/2008/07/24/How-to-review-NHibernate-application.aspx">don&#8217;t create the ISession inside the repository</a>, since this is considered a bad practice. Instead, I create a new Session per request. To do that, I expected I would have some infrastructure in place in MvcContrib, but that was not the case. <a href="http://jeffreypalermo.com">Jeffrey Palermo</a> posted a <a href="http://jeffreypalermo.com/blog/use-this-nhibernate-wrapper-to-keep-your-repository-classes-simple/">NHibernate wrapper to manage ISession</a>, but I thought that class had too many responsibilities, so I separated it in the following.</p><br /><br /><pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">SessionFactoryBuilder<br /></span>{<br />    <span style="color: blue">private static </span><span style="color: #2b91af">ISessionFactory </span>_sessionFactory;<br /><br />    <span style="color: blue">private readonly </span><span style="color: #2b91af">IPersistenceConfigurer </span>_dbConfiguration;<br /><br />    <span style="color: blue">public </span>SessionFactoryBuilder(<span style="color: #2b91af">IPersistenceConfigurer </span>dbConfiguration)<br />    {<br />        _dbConfiguration = dbConfiguration;<br />    }<br /><br />    <span style="color: blue">public </span><span style="color: #2b91af">ISessionFactory </span>Build()<br />    {<br />        <span style="color: blue">if </span>(_sessionFactory == <span style="color: blue">null</span>)<br />        {<br />            _sessionFactory  = GetDbConfiguration().BuildSessionFactory();   <br />        }<br /><br />        <span style="color: blue">return </span>_sessionFactory;<br />    }<br /><br />    <span style="color: blue">public </span><span style="color: #2b91af">Configuration </span>GetDbConfiguration()<br />    {<br />        <span style="color: blue">return </span><span style="color: #2b91af">Fluently</span>.Configure()<br />                .Mappings(m =&gt; m.FluentMappings.AddFromAssemblyOf&lt;<span style="color: #2b91af">Dinner</span>&gt;())<br />                .Database(_dbConfiguration)                    <br />                .BuildConfiguration();<br />    }<br />}</pre><br /><br /><p>This builds the session factory and also returns the configuration (useful to create the schema). It needs an IPersistenceConfigurer, which I supply from the constructor, in order to be able to switch between different configurations (i.e. MSSQL and SQLite), as shown below:</p><br /><br /><pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">MsSqlPersistenceConfigurerFactory </span>: <span style="color: #2b91af">IPersistenceConfigurerFactory<br /></span>{<br />    <span style="color: blue">private string </span>_connectionString;<br /><br />    <span style="color: blue">public </span>MsSqlPersistenceConfigurerFactory(<span style="color: blue">string </span>connectionString)<br />    {<br />        _connectionString = connectionString;<br />    }<br /><br />    <span style="color: blue">public </span><span style="color: #2b91af">IPersistenceConfigurer </span>GetPersistenceConfigurer()<br />    {<br />        <span style="color: blue">return </span><span style="color: #2b91af">MsSqlConfiguration</span>.MsSql2005<br />                .ConnectionString(c =&gt; c.Is(_connectionString))<br />                .ShowSql()<br />                .FormatSql()<br />                .ProxyFactoryFactory&lt;<span style="color: #2b91af">ProxyFactoryFactory</span>&gt;();<br />    }<br />}</pre><br /><br /><h4>Life of a Session</h4><br /><br /><p>We need to create the aforementioned ISession somehow. In Web applications, it&#8217;s generally a good practice to create a new Session on every request. For that, Ayende recently <a href="http://ayende.com/Blog/archive/2009/08/05/do-you-need-a-framework.aspx">suggested</a> to just stick it in the global.asax, but I prefer to put it in a separate&#160; IHttpModule.</p><br /><br /><pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">NhSessionPerRequestModule </span>: <span style="color: #2b91af">IHttpModule<br /></span>{<br />    <span style="color: blue">private readonly </span><span style="color: #2b91af">ISessionFactory </span>_sessionFactory;<br /><br />    <span style="color: blue">public </span>NhSessionPerRequestModule(<span style="color: #2b91af">ISessionFactory </span>sessionFactory)<br />    {<br />        _sessionFactory = sessionFactory;<br />    }<br />    <span style="color: blue">public void </span>Init(<span style="color: #2b91af">HttpApplication </span>application)<br />    {<br />        application.BeginRequest += <span style="color: blue">delegate<br />                                    </span>{<br />                                        CurrentSession = _sessionFactory.OpenSession();<br />                                    };<br /><br />        application.EndRequest += <span style="color: blue">delegate<br />                                  </span>{<br />                                      <span style="color: blue">if </span>(CurrentSession != <span style="color: blue">null</span>)<br />                                      {<br />                                          CurrentSession.Dispose();<br />                                      }<br />                                  };<br />    }<br /><br />    <span style="color: blue">public static </span><span style="color: #2b91af">ISession </span>CurrentSession<br />    {<br />        <span style="color: blue">get </span>{ <span style="color: blue">return </span>(<span style="color: #2b91af">ISession</span>)<span style="color: #2b91af">HttpContext</span>.Current.Items[<span style="color: #a31515">&quot;current.session&quot;</span>]; }<br />        <span style="color: blue">private set </span>{ <span style="color: #2b91af">HttpContext</span>.Current.Items[<span style="color: #a31515">&quot;current.session&quot;</span>] = <span style="color: blue">value</span>; }<br />    }<br /><br />    <span style="color: blue">public void </span>Dispose()<br />    {        <br />    }<br />}</pre><br /><a href="http://11011.net/software/vspaste"></a><br /><br /><p>In my Global.asax, I configure it as follows:</p><br /><br /><pre class="code"><span style="color: blue">private static readonly </span><span style="color: #2b91af">ISessionFactory </span>SessionFactory = CreateSessionFactory();<br /><span style="color: blue">private static </span><span style="color: #2b91af">IWindsorContainer </span>_container;<br /><br /><span style="color: blue">private static </span><span style="color: #2b91af">ISessionFactory </span>CreateSessionFactory()<br />{<br />    <span style="color: blue">string </span>connString = <span style="color: #2b91af">ConfigurationManager</span>.ConnectionStrings[<span style="color: #a31515">&quot;AltNerdDinner&quot;</span>].ConnectionString;<br />    <span style="color: blue">return new </span><span style="color: #2b91af">SessionFactoryBuilder</span>(<br />            <span style="color: blue">new </span><span style="color: #2b91af">MsSqlPersistenceConfigurerFactory</span>(connString)<br />                    .GetPersistenceConfigurer())<br />            .Build();<br />}<br /><br /><span style="color: blue">private readonly </span><span style="color: #2b91af">NhSessionLifetimeModule </span>_nhSessionLifetimeModule =<br />        <span style="color: blue">new </span><span style="color: #2b91af">NhSessionLifetimeModule</span>(SessionFactory);<br /><br /><span style="color: blue">public override void </span>Init()<br />{<br />    <span style="color: blue">base</span>.Init();<br />    _nhSessionLifetimeModule.Init(<span style="color: blue">this</span>);<br />}</pre><br /><br /><p>Lastly, this is my current configuration of the container in order to register the components:</p><br /><br /><pre class="code"><span style="color: blue">private void </span>RegisterComponents()<br /> {<br />     _container = <span style="color: blue">new </span><span style="color: #2b91af">WindsorContainer</span>();<br />     _container.AddFacility&lt;<span style="color: #2b91af">FactorySupportFacility</span>&gt;();<br /><br />     <span style="color: #2b91af">ControllerBuilder</span>.Current.SetControllerFactory(<br />         <span style="color: blue">new </span><span style="color: #2b91af">WindsorControllerFactory</span>(_container));<br /><br />     _container.Register(<br />             <span style="color: #2b91af">Component</span>.For&lt;<span style="color: #2b91af">ISession</span>&gt;()<br />                     .UsingFactoryMethod(() =&gt; <span style="color: #2b91af">NhSessionLifetimeModule</span>.CurrentSession)<br />                     .LifeStyle.Transient);<br />  <br />     _container.Register(<br />             <span style="color: #2b91af">Component</span>.For&lt;<span style="color: #2b91af">IDinnerRepository</span>&gt;()<br />                     .ImplementedBy&lt;<span style="color: #2b91af">NhDinnerRepository</span>&gt;().LifeStyle.Transient);<br /><br />     _container.RegisterControllers(<span style="color: #2b91af">Assembly</span>.GetExecutingAssembly());<br /> }</pre>  </div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/10/16/java-and-lack-of-coc/">Java and (the lack of) CoC</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-16T00:00:00+02:00" pubdate data-updated="true">Oct 16<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<blockquote>   <p>&quot;Java is a DSL to transform big Xml documents into long exception stack traces.&quot;</p>   <cite> Scott Bellware</cite></blockquote>  </div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/10/14/altnerddinner-part-3-introducing-fluent/">AltNerdDinner: Part 3. Introducing Fluent NHibernate. Mapping, the easy way</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-14T00:00:00+02:00" pubdate data-updated="true">Oct 14<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<p><em>This is part 3 of the <a href="http://sharpbites.blogspot.com/2009/08/introducing-altnerddinner.html">AltNerdDinner</a> Series.</em></p>  <p>One of the things I always disliked the most when exploring NHibernate was the need of declaring all the mappings in XMhelL. And don&#8217;t know about you, but that&#8217;s not something I want to be spending my time creating, modifying, hand-refactoring or debugging tedious tons of this crap.</p>  <p>Fast forward to 2008 and say hello to <a href="http://fluentnhibernate.org/">Fluent NHibernate</a>. (And don&#8217;t forget to thank <a href="http://codebetter.com/blogs/jeremy.miller/">Jeremy Miller</a>, <a href="http://blog.jagregory.com/">James Gregory</a> <a href="http://code.google.com/p/fluent-nhibernate/people/list"><em>et al</em></a>!). It is basically a way to programmatically declare the mappings, allowing you to go from this:</p>  <pre class="code"><span style="color: blue">&lt;?</span><span style="color: #a31515">xml </span><span style="color: red">version</span><span style="color: blue">=</span>&quot;<span style="color: blue">1.0</span>&quot; <span style="color: red">encoding</span><span style="color: blue">=</span>&quot;<span style="color: blue">utf-8</span>&quot; <span style="color: blue">?&gt;  <br />&lt;</span><span style="color: #a31515">hibernate-mapping </span><span style="color: red">xmlns</span><span style="color: blue">=</span>&quot;<span style="color: blue">urn:nhibernate-mapping-2.2</span>&quot;  <br />  <span style="color: red">namespace</span><span style="color: blue">=</span>&quot;<span style="color: blue">QuickStart</span>&quot; <span style="color: red">assembly</span><span style="color: blue">=</span>&quot;<span style="color: blue">QuickStart</span>&quot;<span style="color: blue">&gt;  <br /> <br />  &lt;</span><span style="color: #a31515">class </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">Cat</span>&quot; <span style="color: red">table</span><span style="color: blue">=</span>&quot;<span style="color: blue">Cat</span>&quot;<span style="color: blue">&gt;  <br />    &lt;</span><span style="color: #a31515">id </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">Id</span>&quot;<span style="color: blue">&gt;  <br />      &lt;</span><span style="color: #a31515">generator </span><span style="color: red">class</span><span style="color: blue">=</span>&quot;<span style="color: blue">identity</span>&quot; <span style="color: blue">/&gt;  <br />    &lt;/</span><span style="color: #a31515">id</span><span style="color: blue">&gt;  <br /> <br />    &lt;</span><span style="color: #a31515">property </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">Name</span>&quot;<span style="color: blue">&gt;  <br />      &lt;</span><span style="color: #a31515">column </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">Name</span>&quot; <span style="color: red">length</span><span style="color: blue">=</span>&quot;<span style="color: blue">16</span>&quot; <span style="color: red">not-null</span><span style="color: blue">=</span>&quot;<span style="color: blue">true</span>&quot; <span style="color: blue">/&gt;  <br />    &lt;/</span><span style="color: #a31515">property</span><span style="color: blue">&gt;  <br />    &lt;</span><span style="color: #a31515">property </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">Sex</span>&quot; <span style="color: blue">/&gt;  <br />    &lt;</span><span style="color: #a31515">many-to-one </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">Mate</span>&quot; <span style="color: blue">/&gt;  <br />    &lt;</span><span style="color: #a31515">bag </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">Kittens</span>&quot;<span style="color: blue">&gt;  <br />      &lt;</span><span style="color: #a31515">key </span><span style="color: red">column</span><span style="color: blue">=</span>&quot;<span style="color: blue">mother_id</span>&quot; <span style="color: blue">/&gt;  <br />        &lt;</span><span style="color: #a31515">one-to-many </span><span style="color: red">class</span><span style="color: blue">=</span>&quot;<span style="color: blue">Cat</span>&quot; <span style="color: blue">/&gt;  <br />      &lt;/</span><span style="color: #a31515">bag</span><span style="color: blue">&gt;  <br />  &lt;/</span><span style="color: #a31515">class</span><span style="color: blue">&gt;  <br />&lt;/</span><span style="color: #a31515">hibernate-mapping</span><span style="color: blue">&gt;</span></pre><br /><br /><p>To this:</p><br /><br /><pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">CatMap </span>: ClassMap&lt;Cat&gt;<br />{<br />    <span style="color: blue">public </span>CatMap()<br />    {<br />        Id(x =&gt; x.Id);<br />        Map(x =&gt; x.Name)<br />          .Length(16)<br />          .Not.Nullable();<br />        Map(x =&gt; x.Sex);<br />        References(x =&gt; x.Mate);<br />        HasMany(x =&gt; x.Kittens);<br />    }<br />}</pre><br /><br /><p>What it gives you, you may ask? Compile-time checks and refactoring support, for a start.</p><br /><br /><h4>But wait, there is more!</h4><br /><br /><p>Fluent NHibernate is built with <a href="http://en.wikipedia.org/wiki/Convention_over_Configuration">Convention over Configuration</a> in mind. So, if you adhere to it, you can greatly reduce the amount of mapping needed, by virtue of <a href="http://wiki.fluentnhibernate.org/Auto_mapping">auto mapping</a>. And you can combine that with explicit ClassMap mappings, like the one above, they are not mutually exclusive.</p><br /><br /><p>Mapping your domain can be as simple as:</p><br /><br /><pre class="code">AutoMap.AssemblyOf&lt;Product&gt;();</pre><br /><br /><h4>And if you call within the next 5 minutes we throw in Conventions for free!</h4><br /><br /><p>&quot;Ok, that might be great for a greenfield project, but I am working in a big brown piece of &#8230; code&quot;, I hear you saying. So you may not have the choice to call your Id&#8217;s &quot;Id&quot; or name your tables exactly after your classes. <a href="http://wiki.fluentnhibernate.org/Conventions">Conventions</a> can greatly help here, allowing you to define your own conventions. That is, if your database naming follows any convention at all, and wasn&#8217;t defined by a bunch of monkeys typing at random.</p><br /><br /><p>For further info, check the <a href="http://fluentnhibernate.org/">site</a>, <a href="http://wiki.fluentnhibernate.org/">wiki</a> and <a href="http://groups.google.com/group/fluent-nhibernate">mailing list</a>.</p><br /><br /><h4>AltNerdDinner&#8217;s mappings</h4><br /><br /><p>Here are the mapping files for AltNerdDinner.</p><br /><br /><pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">DinnerMap </span>: <span style="color: #2b91af">ClassMap</span>&lt;<span style="color: #2b91af">Dinner</span>&gt;<br />{<br />    <span style="color: blue">public </span>DinnerMap()<br />    {<br />        Id(x =&gt; x.DinnerID);<br />        Map(x =&gt; x.Address).Not.Nullable();<br />        Map(x =&gt; x.ContactPhone).Not.Nullable();<br />        Map(x =&gt; x.Country).Not.Nullable();<br />        Map(x =&gt; x.Description).Not.Nullable();<br />        Map(x =&gt; x.EventDate).Not.Nullable();<br />        Map(x =&gt; x.HostedBy).Not.Nullable();<br />        Map(x =&gt; x.Latitude).Not.Nullable();<br />        Map(x =&gt; x.Longitude).Not.Nullable();<br />        Map(x =&gt; x.Title).Not.Nullable();<br />        HasMany(x =&gt; x.RSVPs).Cascade.AllDeleteOrphan();<br />    }<br />}</pre><br /><a href="http://11011.net/software/vspaste"></a><br /><br /><pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">RSVPMap </span>: <span style="color: #2b91af">ClassMap</span>&lt;<span style="color: #2b91af">RSVP</span>&gt;<br />{<br />    <span style="color: blue">public </span>RSVPMap()<br />    {<br />        Id(x =&gt; x.RsvpId);<br />        Map(x =&gt; x.AttendeeName).Not.Nullable();<br />        References(r =&gt; r.Dinner).<strong>Nullable()</strong>;            <br />    }<br />}</pre><br /><br /><p><a href="http://11011.net/software/vspaste"></a>One gotcha that had me fiddling around for a while was that Nullable part on the Dinner reference in RSVPMap. If you don&#8217;t set it to nullable, you&#8217;ll get an exception when trying to persist the entities. And even if you set it to nullable, you&#8217;ll find out, NHibernate executes two queries to insert the RSVP.</p><br /><br /><blockquote><br />  <p>&#160;&#160;&#160; INSERT INTO&#160; [RSVP] (AttendeeName, Dinner_id) VALUES (@p0, @p1); <br />    <br />&#160;&#160;&#160; select SCOPE_IDENTITY(); <br /><br />    <br />&#160;&#160;&#160; @p0 = &#8216;alberto&#8217;, <br /><br />    <br />&#160;&#160;&#160; @p1 = 9 <br /><br />    <br />&#160;&#160;&#160; UPDATE [RSVP] SET Dinner_id = @p0 WHERE RsvpId = @p1; @p0 = 9, @p1 = 21</p><br /></blockquote><br /><br /><p>You can find <a href="http://nhforge.org/doc/nh/en/index.html#example-parentchild-bidir">more info</a> about this behavior in the <a href="http://nhforge.org/">official nhibernate site</a>.</p><br /><br /><p>So, what I have done instead is to set the RSVP as the managing part of the relationship, changing it back to not nullable and using Inverse() on the Dinner&#8217;s mapping side.</p><br /><a href="http://11011.net/software/vspaste"></a><br /><br /><p>It is not possible to make the &quot;many part&quot; responsible for this. What this means is that we have to persist our entities calling:</p><br /><br /><pre class="code"><span style="color: #2b91af">Dinner </span>dinner = _dinnerRepository.GetDinner(id);<br /><span style="color: blue">var </span>rsvp = <span style="color: blue">new </span><span style="color: #2b91af">RSVP</span>{ AttendeeName = username };<br />rsvp.Dinner = dinner;<br />dinner.Rsvps.Add(rsvp);<br />_dinnerRepository.Save(dinner);</pre><br /><br /><p><a href="http://11011.net/software/vspaste"></a>That&#8217;s not very ideal, so I have included an AddRsvp() method in Dinner to handle that. Now I have:</p><br /><br /><pre class="code"><span style="color: #2b91af">Dinner </span>dinner = _dinnerRepository.GetDinner(id);<br />dinner.AddRsvp(<span style="color: blue">new </span><span style="color: #2b91af">RSVP</span>{ AttendeeName = User.Identity.Name });<br />_dinnerRepository.Save(dinner);</pre><br /><br /><p>Much cleaner! In order to avoid confusion when adding an RSVO, I have changed the type of the collection to an IEnumerable&lt;RSVP&gt;, so that the collection cannot be modified directly, but only by means of Dinner (which is a good practice if you want to follow DDD, anyway). Because of that, I had to modified the DinnerMap to use a backing field for it. In the future I might revisit this relationship to include the User in the domain again and change it to a less CRUD-y style. You can read more on <a href="http://www.udidahan.com/2008/02/15/from-crud-to-domain-driven-fluency/">Domain-Driven fluency</a> from <a href="http://www.udidahan.com/2008/02/15/from-crud-to-domain-driven-fluency/">Udi Dahan</a>.</p><br /><br /><p>Anyway, here is the final mapping I have come up with:</p><br /><br /><pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">RSVPMap </span>: <span style="color: #2b91af">ClassMap</span>&lt;<span style="color: #2b91af">RSVP</span>&gt;<br />{<br />    <span style="color: blue">public </span>RSVPMap()<br />    {<br />        Id(x =&gt; x.RsvpId);<br />        Map(x =&gt; x.AttendeeName).Not.Nullable();<br />        References(r =&gt; r.Dinner).Not.Nullable();            <br />    }<br />}</pre><br /><a href="http://11011.net/software/vspaste"></a><br /><br /><pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">DinnerMap </span>: <span style="color: #2b91af">ClassMap</span>&lt;<span style="color: #2b91af">Dinner</span>&gt;<br />{<br />    <span style="color: blue">public </span>DinnerMap()<br />    {<br />        Id(x =&gt; x.DinnerID);<br />        Map(x =&gt; x.Address).Not.Nullable();<br />        Map(x =&gt; x.ContactPhone).Not.Nullable();<br />        Map(x =&gt; x.Country).Not.Nullable();<br />        Map(x =&gt; x.Description).Not.Nullable();<br />        Map(x =&gt; x.EventDate).Not.Nullable();<br />        Map(x =&gt; x.HostedBy).Not.Nullable();<br />        Map(x =&gt; x.Latitude).Not.Nullable();<br />        Map(x =&gt; x.Longitude).Not.Nullable();<br />        Map(x =&gt; x.Title).Not.Nullable();<br />        HasMany(x =&gt; x.Rsvps).Access.CamelCaseField(<span style="color: #2b91af">Prefix</span>.Underscore)<br />            .Inverse().Cascade.AllDeleteOrphan();<br />    }<br />}</pre>  </div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/10/06/altnerddinner-part-2-rich-man/">AltNerdDinner: Part 2. Rich Man&#8217;s Dependency Injection</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-06T00:00:00+02:00" pubdate data-updated="true">Oct 6<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<p></p>  <p><em>This is part 2 of the <a href="http://sharpbites.blogspot.com/2009/08/introducing-altnerddinner.html">AltNerdDinner</a> Series.</em></p>  <p>The classes in <a href="http://nerddinner.codeplex.com/">NerdDinner</a> use <a href="http://martinfowler.com/articles/injection.html">dependency injection</a> (<a href="http://martinfowler.com/articles/injection.html#ConstructorInjectionWithPicocontainer">constructor injection</a>, to be more precise), which is a form of <a href="http://martinfowler.com/bliki/InversionOfControl.html">Inversion of Control</a> that allows you to break the dependencies between classes, minimizing coupling (i.e. a Good Thing &#8482;). Instead having classes with direct dependencies&#160; on other classes, and instantiating them directly, classes are dependent on interfaces, and the concrete implementation is injected via the constructor, in this case, or via a setter in the case of <a href="http://martinfowler.com/articles/injection.html#SetterInjectionWithSpring">setter injection</a>. Constructor injection is preferred for required dependencies, as it makes dependencies more explicit, and setter injection is usually reserved for optional dependencies.</p>  <p>Using this technique, the responsibility of providing the dependencies is delegated to the calling object (hence the term Inversion of Control).</p>  <h4>Poor Man&#8217;s Dependency Injection</h4>  <p>The problem with the NerdDinner codebase is that, besides the constructor that accepts the required dependencies, they added a default constructor that news up those dependencies. Here is an example:</p>  <pre class="code"><span style="color: blue">public </span>DinnersController() : <span style="color: blue">this</span>(<span style="color: blue">new </span>DinnerRepository())<br />{<br />}<br /><br /><span style="color: blue">public </span>DinnersController(<span style="color: #2b91af">IDinnerRepository </span>repository) {<br />    dinnerRepository = repository;<br />}</pre><br /><br /><p>This may look like a good compromise. You get the decoupling needed to run your tests (by means of the constructor accepting parameters) and you are also able to instantiate you classes calling the default constructor, without the added complexity of an IoC container. However this technique is considered an <a href="http://www.lostechies.com/blogs/jimmy_bogard/archive/2009/07/03/how-not-to-do-dependency-injection-in-nerddinner.aspx">anti-pattern</a> (although <a href="http://devlicio.us/blogs/tim_barcz/archive/2009/07/12/why-there-s-nothing-wrong-with-dependency-injection-in-nerddinner.aspx">not everybody agrees</a>) <a href="http://www.lostechies.com/blogs/chad_myers/archive/2009/07/14/the-usual-result-of-poor-man-s-dependency-injection.aspx">leading to many headaches</a>. By adding this constructor we&#8217;re almost at square one again. Our classes are still coupled, and if we need to add new dependencies, we&#8217;ll have to go hunting around to fix all the constructor calls.</p><br /><br /><h4>If I were a rich man</h4><br /><br /><p>So now you are convinced to use an IoC container, you can have a look this <a href="http://www.lostechies.com/blogs/jimmy_bogard/archive/2008/09/12/some-ioc-container-guidelines.aspx">container guidelines</a> by <a href="http://www.lostechies.com/blogs/jimmy_bogard/default.aspx">Jimmy Bogard</a>. He may not consider his recommendations as best practices, but I do (and so should you, IMHO). I picked <a href="http://www.castleproject.org/container/gettingstarted/index.html">Castle Windsor</a> as my framework of choice. As usual, <a href="http://structuremap.sourceforge.net/">there</a> <a href="http://code.google.com/p/autofac/">are</a> <a href="http://ninject.org/">plenty</a>&#160;<a href="http://www.spring.net/">of</a> <a href="http://www.codeplex.com/unity">alternatives</a>. Even though the API is not the cleanest of all the frameworks, I favored Windsor because it is very mature, is widely adopted, it also supports .NET 2.0, and has good integration with NHibernate. It also is the container used in <a href="http://code.google.com/p/sharp-architecture/">S#arp Architecture</a>, which is something I will probably end up using. Otherwise, my choice would be <a href="http://structuremap.sourceforge.net/">StructureMap</a>.</p><br /><br /><p>In order to use Windsor, you have to reference on your project <em>Castle.Core</em>, <em>Castle.MicroKernel</em> and <em>Castle.Windsor</em>. To ease the configuration of the container, I also downloaded <a href="http://www.codeplex.com/MVCContrib">MvcContrib</a> (which I was planning to use anyway) and added a reference to <em>MvcContrib.Castle</em>.</p><br /><br /><p>This is the code needed to register the controllers and the Repository.</p><br /><br /><pre class="code"><span style="color: blue">private void </span>RegisterComponents()<br />{<br />    _container = <span style="color: blue">new </span><span style="color: #2b91af">WindsorContainer</span>();<br />    <span style="color: #2b91af">ControllerBuilder</span>.Current.SetControllerFactory(<br />        <span style="color: blue">new </span><span style="color: #2b91af">WindsorControllerFactory</span>(_container));<br />    _container.RegisterControllers(<span style="color: #2b91af">Assembly</span>.GetExecutingAssembly());<br />    _container.Register(<br />            <span style="color: #2b91af">Component</span>.For&lt;<span style="color: #2b91af">IDinnerRepository</span>&gt;()<br />            .ImplementedBy&lt;<span style="color: #2b91af">InMemoryDinnerRepository</span>&gt;());<br />}</pre><br /><br /><p>To allow the creation of the controllers by the MVC framework, you need to supply a ControllerFactory that can instantiate them, as they now take dependencies on their constructors. MvcContrib provides one for Windsor, as well as the method RegisterControllers to, guess what, registering all the controllers in a specified assembly. I also registered my DinnerRepository, so that Windsor can resolve the references to it.</p>  </div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/10/03/altnerddinner-part-1-removing-unwanted/">AltNerdDinner: Part 1. Removing unwanted dependencies</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-03T00:00:00+02:00" pubdate data-updated="true">Oct 3<span>rd</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<p>The first thing I have done is to set up the project on <a href="http://github.com/">github</a>, so if you want to have a look at the code, check the <a href="http://github.com/alberto/altnerddinner">AltNerdDinner repository</a>. Then I set up the project following the guidelines of my series <a href="http://sharpbites.blogspot.com/2009/09/road-to-continuous-integration.html">Continuous Integration series</a>.</p>  <p>Now we are set, there is some stuff I don&#8217;t want in AltNerdDinner, so I am mercilessly going to get rid of it.</p>  <h4>Bye, MSTest</h4>  <p>MSTest gives nothing useful beyond integration in VS (for which I prefer ReSharper&#8217;s Test Runner or TDD.NET). I won&#8217;t say it sucks, but <a href="http://haacked.com/archive/2007/09/04/should-microsoft-really-bundle-open-source-software.aspx">Phil Haack did</a>. It&#8217;s just there to satisfy MS-Only shops. It&#8217;s slow, and it evolves slowly too. It lags behind <a href="http://www.nunit.org/index.php">the</a>&#160;<a href="http://www.gallio.org/">alternative</a> <a href="http://www.codeplex.com/xunit">frameworks</a>. Oh, and it requires VS to be installed on your build server (crazy!), and&#8230; </p>  <p>So I replaced it with good ol&#8217;&#160; <a href="http://www.nunit.org/index.php">NUnit</a>. It basically involves replacing:</p>  <p>using Microsoft.VisualStudio.TestTools.UnitTesting; by using NUnit.Framework;</p>  <blockquote>   <p>[TestClass] and [TestMethod] by [TestFixture],&#160; and [Test]</p> </blockquote>  <p>and a bunch of calls to Assert.IsInstanceOfType(object, type); by Assert.IsInstanceOf(type, object); (pay attention to the signature change!).</p>  <h4>We don&#8217;t need no membership provider</h4>  <p>Right now I don&#8217;t want to deal with membership provider. I think it&#8217;s bloated and I don&#8217;t want to have to mess with the authentication right now, so I am going to replace it with a FakeMembershipService for the moment and leave the decision of whether revisiting it or completely replacing it (probably the latter) for a later time.</p>  <h4>LINQ to SQL is dead, long live NHibernate</h4>  <p>L2S is probably a decent option for this kind of simple app, and it&#8217;s very easy to quickly duct-tape a simple app. It has some goodies, like the visual designer and of course Linq. But it&#8217;s not the best option if your app gets bigger and you need some more advanced ORM features, like different mapping capabilities or different databases support. It&#8217;s not a bad tool, but it has <a href="http://codebetter.com/blogs/ian_cooper/archive/2008/07/01/architecting-linq-to-sql-part-10.aspx">some limitations</a> that need to be addressed and, unfortunately, the fact that <a href="http://www.infoq.com/news/2008/11/DLINQ-Future">L2S is being killed</a> means you are better not investing hard into it.</p>  <p>So I am planning to replace it with NHibernate, a mature and tested product&#160; that fits my needs. But just not yet. Right now, I will simply remove the L2S stuff and work with POCOs and an InMemoryRepository implementation (which is basically the FakeDinnerRepository present in the Tests project).</p>  <h5>The model</h5>  <p>As we can see on the picture of the original model, the domain is quite simple.<a href="http://lh3.ggpht.com/_kQ7iivKjVno/SseCJ_ZEG0I/AAAAAAAAAMQ/ehF8shEf9Dg/s1600-h/image11.png"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" src="http://lh3.ggpht.com/_kQ7iivKjVno/SseCKvw9G1I/AAAAAAAAAMU/ft6vs8PlB_0/image_thumb9.png?imgmax=800" width="488" height="259" /></a></p>  <p>I have simply created POCO classes replacing the L2S generated ones.</p>  <p>After all the changes, we run all the tests and&#8230;</p>  <p><a href="http://lh5.ggpht.com/_kQ7iivKjVno/SseCLKN9WMI/AAAAAAAAAMY/KpeLlk_F18c/s1600-h/testsgreen2.jpg"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="tests-green" src="http://lh5.ggpht.com/_kQ7iivKjVno/SseCL4M-ONI/AAAAAAAAAMc/Nr3Jv3PFVPc/testsgreen_thumb.jpg?imgmax=800" width="184" height="34" /></a></p>  <p>We&#8217;re done!</p>  </div>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/07/02/an-introduction-to-the-ruby-ecosystem-for-noobies/">An introduction to the ruby ecosystem for noobies</a>
      </li>
    
      <li class="post">
        <a href="/2012/03/04/rails-start-1-month-ago/">rails.start 1.month.ago</a>
      </li>
    
      <li class="post">
        <a href="/2012/03/03/movin-in/">Movin&#8217; in</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/06/git-started-1-using-git-with-svn-server/">git started #1. Using git with a svn server</a>
      </li>
    
      <li class="post">
        <a href="/2011/10/23/change/">Change</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/alberto">@alberto</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'alberto',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("sharpbites", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/sharpbites" class="twitter-follow-button" data-show-count="false">Follow @sharpbites</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - alberto -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sharpbites';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
