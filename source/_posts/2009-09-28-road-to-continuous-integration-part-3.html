---
layout: post
title: "The road to Continuous Integration. Part 3: Script it, build it, test it, break it, fix it. Commit it."
date: 2009-09-28
comments: true
categories:
 - agile
 - project automation
 - project management
 - continuous integration
---

<div class='post'>
Ideally, any new developer in your team should be able to build your project with a single command or double-click. To accomplish that, we are going to use a build script.  <br />You can also <a href="http://nant.sourceforge.net/">pick</a> <a href="http://msdn.microsoft.com/en-us/library/0k6kkbsd.aspx">your</a> <a href="http://rake.rubyforge.org/">poison</a> here, too. I am going to stick with nant for the moment, because it's the most mature and broadly used, and the one I know better, despite of the <i>XMHell</i> that is the angle-bracket orgy it imposes. <a href="http://codebetter.com/blogs/david_laribee/archive/2008/08/25/omg-rake.aspx">Rake seems nice</a>, and has less noise than the others, but I don't like the fact that I have to install ruby and rake separately. As I said, I like all of my dependencies being included in source control, so that my projects are self-contained (there are some efforts to get <a href="http://www.stephenbalkum.com/archive/2009/06/09/when-all-you-need-is-a-rake.aspx">ruby and rake as a single executable</a>, though). If you are hesitating between msbuild and nant, you can check out a <a href="http://sharpbites.blogspot.com/2008/09/nant-vs-msbuild.html">comparison between nant and msbuild</a> I did a while ago.  <br /><a href="http://lh5.ggpht.com/_kQ7iivKjVno/SsEIh_i4iCI/AAAAAAAAAME/oexhq-gr7N4/s1600-h/projectstructure10.jpg"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="project-structure" align="left" src="http://lh6.ggpht.com/_kQ7iivKjVno/SsEIiowefII/AAAAAAAAAMI/TuxGRy-ffPI/projectstructure_thumb8.jpg?imgmax=800" width="155" height="244" /></a>  <br />As you can see on the picture, I have added two build scripts to the root of <a href="http://github.com/alberto/altnerddinner">AltNerdDinner</a>. <i><a href="http://github.com/alberto/altnerddinner/blob/master/common-targets.build">common-targets.build</a></i> has, you know, common nant targets. It's a script I reuse between projects and it has all the tasks I usually execute (compile, recompile, publish or package the project, run the tests, analyze the code or binaries, etc). <i><a href="http://github.com/alberto/altnerddinner/blob/master/AltNerdDinner.build">AltNerdDinner.build</a></i> is the specific script for this project. By virtue of <a href="http://en.wikipedia.org/wiki/Convention_over_configuration">Convention over Configuration</a> on the project structure and directory and file names, we can remove a lot of unnecessary noise. By adhering to conventions, we just have to set up a couple of properties and simply delegate on common-targets.build for most (if not all) of the tasks, just defining the dependencies between tasks and passing parameters to configure the task where needed.  <br />  <br />You can see below how simple it gets, with only 16 lines of code:  <br />  <br />  <pre class="code"><span style="color: blue"></span><span style="color: blue"></span></pre><br /><a href="http://11011.net/software/vspaste"></a><br /><br /><pre class="code"><span style="color: blue">&lt;?</span><span style="color: #a31515">xml </span><span style="color: red">version</span><span style="color: blue">=</span>&quot;<span style="color: blue">1.0</span>&quot; <span style="color: blue">?&gt;<br />&lt;</span><span style="color: #a31515">project </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">AltNerdDinner</span>&quot; <span style="color: red">default</span><span style="color: blue">=</span>&quot;<span style="color: blue">compile</span>&quot;<span style="color: blue">&gt;<br />  &lt;</span><span style="color: #a31515">property </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">dir.root</span>&quot; <span style="color: red">value</span><span style="color: blue">=</span>&quot;<span style="color: blue">${path::get-full-path('.')}</span>&quot; <span style="color: blue">/&gt;<br />  &lt;</span><span style="color: #a31515">include </span><span style="color: red">buildfile</span><span style="color: blue">=</span>&quot;<span style="color: blue">${dir.root}/common-targets.build</span>&quot; <span style="color: blue">/&gt;<br />  &lt;</span><span style="color: #a31515">property </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">file.solution</span>&quot; <span style="color: red">value</span><span style="color: blue">=</span>&quot;<span style="color: blue">${dir.root}/NerdDinner.sln</span>&quot; <span style="color: blue">/&gt;<br />  &lt;</span><span style="color: #a31515">property </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">file.project</span>&quot; <span style="color: red">value</span><span style="color: blue">=</span>&quot;<span style="color: blue">${dir.root}/src/NerdDinner/NerdDinner.csproj</span>&quot; <span style="color: blue">/&gt;<br />  &lt;</span><span style="color: #a31515">property </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">assembly.tests</span>&quot; <span style="color: red">value</span><span style="color: blue">=</span>&quot;<span style="color: blue">NerdDinner.Tests.dll</span>&quot; <span style="color: blue">/&gt;<br /><br />  &lt;</span><span style="color: #a31515">target </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">compile</span>&quot; <span style="color: red">depends</span><span style="color: blue">=</span>&quot;<span style="color: blue">common.clean, common.init, common.compile</span>&quot; <span style="color: blue">/&gt;<br />  &lt;</span><span style="color: #a31515">target </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">test</span>&quot; <span style="color: red">depends</span><span style="color: blue">=</span>&quot;<span style="color: blue">compile, common.test</span>&quot; <span style="color: blue">/&gt;<br />  &lt;</span><span style="color: #a31515">target </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">publish</span>&quot; <span style="color: red">depends</span><span style="color: blue">=</span>&quot;<span style="color: blue">test, common.publish</span>&quot; <span style="color: blue">/&gt;<br />  &lt;</span><span style="color: #a31515">target </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">zip</span>&quot; <span style="color: red">depends</span><span style="color: blue">=</span>&quot;<span style="color: blue">publish, common.zip</span>&quot; <span style="color: blue">/&gt;<br />  &lt;</span><span style="color: #a31515">target </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">analyze</span>&quot; <span style="color: red">depends</span><span style="color: blue">=</span>&quot;<span style="color: blue">publish, common.stylecop, common.ndepend</span>&quot; <span style="color: blue">/&gt;<br />  &lt;</span><span style="color: #a31515">target </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">build</span>&quot; <span style="color: red">depends</span><span style="color: blue">=</span>&quot;<span style="color: blue">publish, analyze</span>&quot; <span style="color: blue">/&gt;<br />  &lt;</span><span style="color: #a31515">target </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">build-full</span>&quot; <span style="color: red">depends</span><span style="color: blue">=</span>&quot;<span style="color: blue">publish, analyze, zip</span>&quot; <span style="color: blue">/&gt;<br />&lt;/</span><span style="color: #a31515">project</span><span style="color: blue">&gt;</span></pre><br /><a href="http://11011.net/software/vspaste"></a><br /><br /><p>There is also a <a href="http://github.com/alberto/altnerddinner/blob/master/go.bat">go.bat</a> script, which just calls nant, passing AltNerdDinner.build as the build file. As a side note, notice that my solution file is in the root of the project instead of in src. I like to keep it there so that I can easily refer to the root of the project from it (useful if you want to dome some pre/post build stuff on Visual Studio or for other tools than reference your solution).</p>  </div>
