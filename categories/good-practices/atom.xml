<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: good practices | sharp bites]]></title>
  <link href="http://www.sharpbites.com/categories/good-practices/atom.xml" rel="self"/>
  <link href="http://www.sharpbites.com/"/>
  <updated>2012-03-05T22:58:24+01:00</updated>
  <id>http://www.sharpbites.com/</id>
  <author>
    <name><![CDATA[alberto]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Writing Better Object Oriented Code]]></title>
    <link href="http://www.sharpbites.com/2010/11/30/writing-better-object-oriented-code/"/>
    <updated>2010-11-30T00:00:00+01:00</updated>
    <id>http://www.sharpbites.com/2010/11/30/writing-better-object-oriented-code</id>
    <content type="html"><![CDATA[<div class='post'>
<a href="http://twitter.com/#!/gregyoung">Greg Young</a> did a great presentation at <a href="http://www.oredev.org/">Oredev</a> about <a href="http://vimeo.com/17151526">writing Object Oriented code the right way</a>. It's so full of good stuff I could not bother to make a summary out of it. Go watch the original video. Now.</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AltNerdDinner: Part 2. Rich Man's Dependency Injection]]></title>
    <link href="http://www.sharpbites.com/2009/10/06/altnerddinner-part-2-rich-man/"/>
    <updated>2009-10-06T00:00:00+02:00</updated>
    <id>http://www.sharpbites.com/2009/10/06/altnerddinner-part-2-rich-man</id>
    <content type="html"><![CDATA[<div class='post'>
<p></p>  <p><em>This is part 2 of the <a href="http://sharpbites.blogspot.com/2009/08/introducing-altnerddinner.html">AltNerdDinner</a> Series.</em></p>  <p>The classes in <a href="http://nerddinner.codeplex.com/">NerdDinner</a> use <a href="http://martinfowler.com/articles/injection.html">dependency injection</a> (<a href="http://martinfowler.com/articles/injection.html#ConstructorInjectionWithPicocontainer">constructor injection</a>, to be more precise), which is a form of <a href="http://martinfowler.com/bliki/InversionOfControl.html">Inversion of Control</a> that allows you to break the dependencies between classes, minimizing coupling (i.e. a Good Thing &#8482;). Instead having classes with direct dependencies&#160; on other classes, and instantiating them directly, classes are dependent on interfaces, and the concrete implementation is injected via the constructor, in this case, or via a setter in the case of <a href="http://martinfowler.com/articles/injection.html#SetterInjectionWithSpring">setter injection</a>. Constructor injection is preferred for required dependencies, as it makes dependencies more explicit, and setter injection is usually reserved for optional dependencies.</p>  <p>Using this technique, the responsibility of providing the dependencies is delegated to the calling object (hence the term Inversion of Control).</p>  <h4>Poor Man's Dependency Injection</h4>  <p>The problem with the NerdDinner codebase is that, besides the constructor that accepts the required dependencies, they added a default constructor that news up those dependencies. Here is an example:</p>  <pre class="code"><span style="color: blue">public </span>DinnersController() : <span style="color: blue">this</span>(<span style="color: blue">new </span>DinnerRepository())<br />{<br />}<br /><br /><span style="color: blue">public </span>DinnersController(<span style="color: #2b91af">IDinnerRepository </span>repository) {<br />    dinnerRepository = repository;<br />}</pre><br /><br /><p>This may look like a good compromise. You get the decoupling needed to run your tests (by means of the constructor accepting parameters) and you are also able to instantiate you classes calling the default constructor, without the added complexity of an IoC container. However this technique is considered an <a href="http://www.lostechies.com/blogs/jimmy_bogard/archive/2009/07/03/how-not-to-do-dependency-injection-in-nerddinner.aspx">anti-pattern</a> (although <a href="http://devlicio.us/blogs/tim_barcz/archive/2009/07/12/why-there-s-nothing-wrong-with-dependency-injection-in-nerddinner.aspx">not everybody agrees</a>) <a href="http://www.lostechies.com/blogs/chad_myers/archive/2009/07/14/the-usual-result-of-poor-man-s-dependency-injection.aspx">leading to many headaches</a>. By adding this constructor we're almost at square one again. Our classes are still coupled, and if we need to add new dependencies, we'll have to go hunting around to fix all the constructor calls.</p><br /><br /><h4>If I were a rich man</h4><br /><br /><p>So now you are convinced to use an IoC container, you can have a look this <a href="http://www.lostechies.com/blogs/jimmy_bogard/archive/2008/09/12/some-ioc-container-guidelines.aspx">container guidelines</a> by <a href="http://www.lostechies.com/blogs/jimmy_bogard/default.aspx">Jimmy Bogard</a>. He may not consider his recommendations as best practices, but I do (and so should you, IMHO). I picked <a href="http://www.castleproject.org/container/gettingstarted/index.html">Castle Windsor</a> as my framework of choice. As usual, <a href="http://structuremap.sourceforge.net/">there</a> <a href="http://code.google.com/p/autofac/">are</a> <a href="http://ninject.org/">plenty</a>&#160;<a href="http://www.spring.net/">of</a> <a href="http://www.codeplex.com/unity">alternatives</a>. Even though the API is not the cleanest of all the frameworks, I favored Windsor because it is very mature, is widely adopted, it also supports .NET 2.0, and has good integration with NHibernate. It also is the container used in <a href="http://code.google.com/p/sharp-architecture/">S#arp Architecture</a>, which is something I will probably end up using. Otherwise, my choice would be <a href="http://structuremap.sourceforge.net/">StructureMap</a>.</p><br /><br /><p>In order to use Windsor, you have to reference on your project <em>Castle.Core</em>, <em>Castle.MicroKernel</em> and <em>Castle.Windsor</em>. To ease the configuration of the container, I also downloaded <a href="http://www.codeplex.com/MVCContrib">MvcContrib</a> (which I was planning to use anyway) and added a reference to <em>MvcContrib.Castle</em>.</p><br /><br /><p>This is the code needed to register the controllers and the Repository.</p><br /><br /><pre class="code"><span style="color: blue">private void </span>RegisterComponents()<br />{<br />    _container = <span style="color: blue">new </span><span style="color: #2b91af">WindsorContainer</span>();<br />    <span style="color: #2b91af">ControllerBuilder</span>.Current.SetControllerFactory(<br />        <span style="color: blue">new </span><span style="color: #2b91af">WindsorControllerFactory</span>(_container));<br />    _container.RegisterControllers(<span style="color: #2b91af">Assembly</span>.GetExecutingAssembly());<br />    _container.Register(<br />            <span style="color: #2b91af">Component</span>.For&lt;<span style="color: #2b91af">IDinnerRepository</span>&gt;()<br />            .ImplementedBy&lt;<span style="color: #2b91af">InMemoryDinnerRepository</span>&gt;());<br />}</pre><br /><br /><p>To allow the creation of the controllers by the MVC framework, you need to supply a ControllerFactory that can instantiate them, as they now take dependencies on their constructors. MvcContrib provides one for Windsor, as well as the method RegisterControllers to, guess what, registering all the controllers in a specified assembly. I also registered my DinnerRepository, so that Windsor can resolve the references to it.</p>  </div>

]]></content>
  </entry>
  
</feed>
